{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport { Form, Button, Image, Modal, Icon, Header } from 'semantic-ui-react';\nimport { getWeb3 } from '../getWeb3';\nimport { getContract } from '../getContract';\nimport Router from '../../routes';\n\nconst IPFS = require('ipfs-api');\n\nconst ipfs = new IPFS({\n  host: 'ipfs.infura.io',\n  port: 5001,\n  protocol: 'https'\n});\n\nclass EditShow extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"fileInputRef\", React.createRef());\n\n    _defineProperty(this, \"close\", () => {\n      this.setState({\n        open: false\n      });\n    });\n\n    _defineProperty(this, \"onSubmit\", async event => {\n      event.preventDefault();\n      let imageHash;\n\n      if (this.state.file != undefined && !this.state.fileBuffer) {\n        window.alert(\"File Not Uploaded\");\n      } else {\n        this.props.changeLoadingState(true);\n\n        if (this.state.file) {\n          this.props.changeLoadingValue(\"Uploading File\");\n          console.log(\"Uploading File\");\n          imageHash = await ipfs.add(this.state.fileBuffer);\n          imageHash = imageHash[0].hash;\n          this.props.changeLoadingValue(\"Loading\");\n        } else {\n          imageHash = this.state.image;\n        }\n\n        const {\n          web3\n        } = await getWeb3();\n        const {\n          contract\n        } = await getContract();\n        const adminAddr = web3.utils.toChecksumAddress(this.props.adminAcc);\n        const amountWei = web3.utils.toWei(this.state.amount, 'ether');\n        const {\n          showName,\n          availableSeats,\n          amount,\n          fromTime,\n          toTime,\n          date\n        } = this.state;\n\n        try {\n          await contract.methods.updateShow(this.props.id, this.state.showName, this.state.availableSeats, amountWei, this.state.fromTime, this.state.toTime, this.state.date, imageHash).send({\n            from: adminAddr\n          });\n          Router.pushRoute('home');\n        } catch (e) {\n          window.alert(e.message);\n        }\n\n        this.props.changeLoadingState(false);\n      }\n    });\n\n    _defineProperty(this, \"makeShowAvailable\", async () => {\n      this.props.changeLoadingState(true);\n      const {\n        contract\n      } = await getContract();\n      const {\n        web3\n      } = await getWeb3();\n      const adminAddr = web3.utils.toChecksumAddress(this.props.adminAcc);\n\n      if (this.state.showAvailable) {\n        try {\n          await contract.methods.makeShowNotAvailable(this.props.id).send({\n            from: adminAddr\n          });\n          Router.pushRoute('home');\n        } catch (e) {\n          window.alert(e.message);\n        }\n      } else {\n        try {\n          await contract.methods.makeShowAvailable(this.props.id).send({\n            from: adminAddr\n          });\n          Router.pushRoute('home');\n        } catch (e) {\n          window.alert(e.message);\n        }\n      }\n\n      this.props.changeLoadingState(false);\n    });\n\n    this.state = {\n      showName: '',\n      availableSeats: 0,\n      showAvailable: false,\n      amount: 0,\n      fromTime: '',\n      toTime: '',\n      date: '',\n      image: '',\n      fileBuffer: undefined,\n      file: undefined,\n      open: false\n    };\n  }\n\n  async componentDidMount() {\n    const show = this.props.show;\n    const {\n      web3\n    } = await getWeb3();\n    this.setState({\n      showName: show.showName,\n      availableSeats: show.seatsAvailable,\n      amount: web3.utils.fromWei(show.amount, 'ether'),\n      date: show.date,\n      showAvailable: show.showAvailable,\n      fromTime: show.fromTime,\n      toTime: show.toTime,\n      image: show.image\n    });\n    const date = new Date();\n    console.log(\"date \", date);\n  }\n\n  render() {\n    if (this.props.admin) {\n      return __jsx(Form, null, __jsx(Form.Group, {\n        unstackable: true,\n        widths: 2\n      }, __jsx(Form.Input, {\n        label: \"Show Name\",\n        placeholder: \"Show Name\",\n        value: this.state.showName,\n        onChange: e => {\n          this.setState({\n            showName: e.target.value\n          });\n        }\n      }), __jsx(Form.Input, {\n        label: \"Available Seats\",\n        placeholder: \"Available Seats\",\n        value: this.state.availableSeats,\n        onChange: e => {\n          this.setState({\n            availableSeats: e.target.value\n          });\n        }\n      })), __jsx(Form.Group, {\n        unstackable: true,\n        widths: 2\n      }, __jsx(Form.Input, {\n        label: \"Amount\",\n        placeholder: \"Amount\",\n        value: this.state.amount,\n        onChange: e => {\n          this.setState({\n            amount: e.target.value\n          });\n        }\n      }), __jsx(Form.Input, {\n        label: \"date\",\n        type: \"date\",\n        value: this.state.date,\n        onChange: e => {\n          this.setState({\n            date: e.target.value\n          });\n        }\n      })), __jsx(Form.Group, {\n        unstackable: true,\n        widths: 2\n      }, __jsx(Form.Input, {\n        label: \"From Time\",\n        type: \"time\",\n        value: this.state.fromTime,\n        onChange: e => {\n          this.setState({\n            fromTime: e.target.value\n          });\n        }\n      }), __jsx(Form.Input, {\n        label: \"To Time\",\n        type: \"time\",\n        value: this.state.toTime,\n        onChange: e => {\n          this.setState({\n            toTime: e.target.value\n          });\n        }\n      })), __jsx(Form.Group, {\n        unstackable: true,\n        widths: 2\n      }, this.state.file ? __jsx(Image, {\n        src: this.state.file,\n        size: \"medium\",\n        rounded: true\n      }) : __jsx(Image, {\n        src: `https://gateway.ipfs.io/ipfs/${this.state.image}`,\n        size: \"medium\",\n        rounded: true\n      })), __jsx(Form.Group, {\n        unstackable: true,\n        widths: 2\n      }, __jsx(Form.Field, null, __jsx(Button, {\n        content: \"Choose File\",\n        labelPosition: \"left\",\n        icon: \"file\",\n        color: \"blue\",\n        onClick: () => this.fileInputRef.current.click()\n      }), __jsx(\"input\", {\n        ref: this.fileInputRef,\n        type: \"file\",\n        hidden: true,\n        onChange: e => {\n          const reader = new window.FileReader();\n          const file = e.target.files[0];\n          reader.readAsArrayBuffer(file);\n\n          reader.onloadend = async () => this.setState({\n            fileBuffer: await Buffer.from(reader.result),\n            file: URL.createObjectURL(file)\n          });\n        }\n      }))), __jsx(Form.Group, {\n        unstackable: true,\n        widths: 2\n      }, __jsx(Form.Field, null, __jsx(Modal, {\n        trigger: __jsx(Button, {\n          type: \"submit\",\n          color: \"blue\",\n          onClick: () => this.setState({\n            open: true\n          })\n        }, \"Update\"),\n        open: this.state.open,\n        onClose: this.close\n      }, __jsx(Modal.Header, null, \"Are you sure to Update this show ?\"), __jsx(Modal.Content, {\n        image: true\n      }, this.state.file ? __jsx(Image, {\n        wrapped: true,\n        size: \"medium\",\n        src: this.state.file\n      }) : __jsx(Image, {\n        wrapped: true,\n        size: \"medium\",\n        src: `https://gateway.ipfs.io/ipfs/${this.state.image}`\n      }), __jsx(Modal.Description, null, __jsx(Header, null, \"Name : \", this.state.showName), __jsx(\"p\", null, \"Seats Available : \", this.state.availableSeats), __jsx(\"p\", null, \"Amount : \", this.state.amount), __jsx(\"p\", null, \"From : \", this.state.fromTime), __jsx(\"p\", null, \"To : \", this.state.toTime), __jsx(\"p\", null, \"Date : \", this.state.date), __jsx(\"p\", null, \"Whether Show is Available for booking : \", this.state.showAvailable ? 'Yes' : 'No'))), __jsx(Modal.Actions, null, __jsx(Button, {\n        color: \"red\",\n        onClick: this.close\n      }, __jsx(Icon, {\n        name: \"remove\"\n      }), \"No\"), __jsx(Button, {\n        color: \"green\",\n        onClick: this.onSubmit\n      }, __jsx(Icon, {\n        name: \"checkmark\"\n      }), \"Yes\"))))), __jsx(Form.Field, null, __jsx(Button, {\n        color: this.state.showAvailable ? 'green' : 'red',\n        onClick: this.makeShowAvailable\n      }, this.state.showAvailable ? \"Make Show Not Available\" : \"Make Show Available\")));\n    } else {\n      return __jsx(\"h1\", null, \"You are not allowed to access this page\");\n    }\n  }\n\n}\n\nexport default EditShow;","map":{"version":3,"sources":["/home/pratheep/Work_Dir/main_dir/TicketBooking/client/components/admin-components/editShow.js"],"names":["React","Component","Form","Button","Image","Modal","Icon","Header","getWeb3","getContract","Router","IPFS","require","ipfs","host","port","protocol","EditShow","constructor","props","createRef","setState","open","event","preventDefault","imageHash","state","file","undefined","fileBuffer","window","alert","changeLoadingState","changeLoadingValue","console","log","add","hash","image","web3","contract","adminAddr","utils","toChecksumAddress","adminAcc","amountWei","toWei","amount","showName","availableSeats","fromTime","toTime","date","methods","updateShow","id","send","from","pushRoute","e","message","showAvailable","makeShowNotAvailable","makeShowAvailable","componentDidMount","show","seatsAvailable","fromWei","Date","render","admin","target","value","fileInputRef","current","click","reader","FileReader","files","readAsArrayBuffer","onloadend","Buffer","result","URL","createObjectURL","close","onSubmit"],"mappings":"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","sourcesContent":["import React,{Component} from 'react';\nimport {Form,Button,Image,Modal,Icon,Header} from 'semantic-ui-react'\nimport {getWeb3} from '../getWeb3'\nimport {getContract} from '../getContract'\nimport Router from '../../routes'\n\nconst IPFS = require('ipfs-api')\nconst ipfs = new IPFS({ host: 'ipfs.infura.io', \n    port: 5001,protocol: 'https' });\n\nclass EditShow extends Component{\n\n\n\tconstructor(props){\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tshowName : '',\n\t\t\tavailableSeats : 0,\n\t\t\tshowAvailable : false,\n\t\t\tamount : 0,\n\t\t\tfromTime : '',\n\t\t\ttoTime : '',\n\t\t\tdate : '',\n\t\t\timage : '',\n\t\t\tfileBuffer : undefined,\n\t\t\tfile : undefined,\n\t\t\topen : false\n\t\t}\n\t}\n\tfileInputRef = React.createRef()\n\n\tasync componentDidMount(){\n\t\tconst show = this.props.show\n\t\tconst {web3} = await getWeb3()\n\t\tthis.setState(\n\t\t\t{\n\t\t\t\tshowName : show.showName,\n\t\t\t\tavailableSeats : show.seatsAvailable,\n\t\t\t\tamount : web3.utils.fromWei(show.amount,'ether'),\n\t\t\t\tdate : show.date,\n\t\t\t\tshowAvailable : show.showAvailable,\n\t\t\t\tfromTime : show.fromTime,\n\t\t\t\ttoTime : show.toTime,\n\t\t\t\timage : show.image\n\t\t\t}\n\t\t)\n\t\tconst date = new Date()\n\t\tconsole.log(\"date \",date)\n\t}\n\n\tclose = ()=>{\n\t\tthis.setState({open : false})\n\t}\n\n\tonSubmit = async(event)=>{\n\t\tevent.preventDefault()\n\t\tlet imageHash\n\t\tif(this.state.file!= undefined && !this.state.fileBuffer){\n\t\t\twindow.alert(\"File Not Uploaded\")\n\t\t}\n\t\telse{\n\t\t\tthis.props.changeLoadingState(true)\n\t\t\tif(this.state.file){\n\t\t\t\tthis.props.changeLoadingValue(\"Uploading File\")\n\t\t\t\tconsole.log(\"Uploading File\")\n\t\t\t\timageHash = await ipfs.add(this.state.fileBuffer)\n\t\t\t\timageHash = imageHash[0].hash\n\t\t\t\tthis.props.changeLoadingValue(\"Loading\")\n\t\t\t}\n\t\t\telse{\n\t\t\t\timageHash = this.state.image\n\t\t\t}\n\t\t\tconst {web3} = await getWeb3()\n\t\t\tconst {contract} = await getContract()\n\t\t\tconst adminAddr = web3.utils.toChecksumAddress(this.props.adminAcc)\n\t\t\tconst amountWei = web3.utils.toWei(this.state.amount,'ether')\n\t\t\tconst {showName,availableSeats,amount,fromTime,toTime,date} = this.state\n\t\t\ttry{\n\t\t\t\tawait contract.methods.updateShow(\n\t\t\t\t\tthis.props.id,this.state.showName,this.state.availableSeats,amountWei,this.state.fromTime,this.state.toTime,this.state.date,imageHash\n\t\t\t\t).send({from:adminAddr})\n\t\t\t\tRouter.pushRoute('home')\n\t\t\t}\n\t\t\tcatch(e){\n\t\t\t\twindow.alert(e.message)\n\t\t\t}\n\t\t\tthis.props.changeLoadingState(false)\n\t\t}\n\t}\n\n\tmakeShowAvailable = async()=>{\n\t\tthis.props.changeLoadingState(true);\n\t\tconst {contract} = await getContract();\n\t\tconst {web3} = await getWeb3();\n\t\tconst adminAddr = web3.utils.toChecksumAddress(this.props.adminAcc)\n\t\tif(this.state.showAvailable){\n\t\t\ttry{\n\t\t\t\tawait contract.methods.makeShowNotAvailable(this.props.id).send({from : adminAddr})\n\t\t\t\tRouter.pushRoute('home')\n\t\t\t}catch(e){\n\t\t\t\twindow.alert(e.message)\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\ttry{\n\t\t\t\tawait contract.methods.makeShowAvailable(this.props.id).send({from : adminAddr})\n\t\t\t\tRouter.pushRoute('home')\n\t\t\t}catch(e){\n\t\t\t\twindow.alert(e.message)\n\t\t\t}\n\t\t}\n\t\tthis.props.changeLoadingState(false);\n\t}\n\n\trender(){\n\t\tif(this.props.admin){\n\t\t\treturn(\n\t\t\t\t<Form>\n\t\t\t\t\t<Form.Group unstackable widths={2}>\n\t\t\t\t\t\t<Form.Input label=\"Show Name\" placeholder=\"Show Name\"\n\t\t\t\t\t\t\tvalue={this.state.showName}\n\t\t\t\t\t\t\tonChange={(e)=>{this.setState({showName : e.target.value})}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Form.Input label=\"Available Seats\" placeholder=\"Available Seats\"\n\t\t\t\t\t\t\tvalue={this.state.availableSeats}\n\t\t\t\t\t\t\tonChange={(e)=>{this.setState({availableSeats : e.target.value})}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group unstackable widths={2}>\n\t\t\t\t\t\t<Form.Input label=\"Amount\" placeholder=\"Amount\"\n\t\t\t\t\t\t\tvalue={this.state.amount}\n\t\t\t\t\t\t\tonChange={(e)=>{this.setState({amount : e.target.value})}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Form.Input label=\"date\" type=\"date\" \n\t\t\t\t\t\t\tvalue={this.state.date}\n\t\t\t\t\t\t\tonChange={(e)=>{this.setState({date : e.target.value})}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group unstackable widths={2}>\n\t\t\t\t\t\t<Form.Input label=\"From Time\" type=\"time\" \n\t\t\t\t\t\t\tvalue={this.state.fromTime}\n\t\t\t\t\t\t\tonChange={(e)=>{this.setState({fromTime : e.target.value})}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Form.Input label=\"To Time\" type=\"time\" \n\t\t\t\t\t\t\tvalue={this.state.toTime}\n\t\t\t\t\t\t\tonChange={(e)=>{this.setState({toTime : e.target.value})}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group unstackable widths={2}>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.state.file\n\t\t\t\t\t\t\t?<Image src={this.state.file} size=\"medium\" rounded/>\n\t\t\t\t\t\t\t:<Image src={`https://gateway.ipfs.io/ipfs/${this.state.image}`} size=\"medium\" rounded />\n\t\t\t\t\t\t}\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group unstackable widths={2}>\n\t\t\t\t\t\t<Form.Field>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tcontent=\"Choose File\"\n\t\t\t\t\t\t\t\tlabelPosition=\"left\"\n\t\t\t\t\t\t\t\ticon=\"file\"\n\t\t\t\t\t\t\t\tcolor=\"blue\"\n\t\t\t\t\t\t\t\tonClick={()=>this.fileInputRef.current.click()}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tref={this.fileInputRef}\n\t\t\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\t\t\thidden\n\t\t\t\t\t\t\t\tonChange={(e)=>{\n\t\t\t\t\t\t\t\t\tconst reader = new window.FileReader()\n\t\t\t\t\t\t\t\t\tconst file = e.target.files[0]\n\t\t\t\t\t\t\t\t\treader.readAsArrayBuffer(file)\n\t\t\t\t\t\t\t\t\treader.onloadend = async()=>this.setState({\n\t\t\t\t\t\t\t\t\t\tfileBuffer : await Buffer.from(reader.result),\n\t\t\t\t\t\t\t\t\t\tfile : URL.createObjectURL(file)\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Form.Field>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Group unstackable widths={2}>\n\t\t\t\t\t\t<Form.Field>\n\t\t\t\t\t\t\t<Modal trigger={<Button type=\"submit\" color=\"blue\" onClick={()=>this.setState({open: true})}>Update</Button>} open={this.state.open} onClose={this.close}>\n\t\t\t\t\t\t\t\t<Modal.Header>Are you sure to Update this show ?</Modal.Header>\n\t\t\t\t\t\t\t\t\t<Modal.Content image>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis.state.file\n\t\t\t\t\t\t\t\t\t\t\t?<Image wrapped size='medium' src={this.state.file}/>\n\t\t\t\t\t\t\t\t\t\t\t:<Image wrapped size='medium' src={`https://gateway.ipfs.io/ipfs/${this.state.image}`}/>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t<Modal.Description>\n\t\t\t\t\t\t\t\t\t\t\t<Header>Name : {this.state.showName}</Header>\n\t\t\t\t\t\t\t\t\t\t\t<p>Seats Available : {this.state.availableSeats}</p>\n\t\t\t\t\t\t\t\t\t\t\t<p>Amount : {this.state.amount}</p>\n\t\t\t\t\t\t\t\t\t\t\t<p>From : {this.state.fromTime}</p>\n\t\t\t\t\t\t\t\t\t\t\t<p>To : {this.state.toTime}</p>\n\t\t\t\t\t\t\t\t\t\t\t<p>Date : {this.state.date}</p>\n\t\t\t\t\t\t\t\t\t\t\t<p>Whether Show is Available for booking : {this.state.showAvailable?'Yes':'No'}</p>\n\t\t\t\t\t\t\t\t\t\t</Modal.Description>\n\t\t\t\t\t\t\t\t\t</Modal.Content>\n\t\t\t\t\t\t\t\t\t<Modal.Actions>\n\t\t\t\t\t\t\t\t\t\t<Button color='red' onClick={this.close}><Icon name='remove'/>No</Button>\n\t\t\t\t\t\t\t\t\t\t<Button color='green' onClick={this.onSubmit}><Icon name='checkmark'/>Yes</Button>\n\t\t\t\t\t\t\t\t\t</Modal.Actions>\n\t\t\t\t\t\t</Modal></Form.Field>\n\t\t\t\t\t</Form.Group>\n\t\t\t\t\t<Form.Field>\n\t\t\t\t\t\t<Button color={this.state.showAvailable?'green':'red'} onClick={this.makeShowAvailable}>{\n\t\t\t\t\t\t\t\t\tthis.state.showAvailable?(\"Make Show Not Available\"):(\"Make Show Available\")\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Form.Field>\n\t\t\t\t</Form>\n\t\t\t)\n\t\t}\n\t\telse{\n\t\t\treturn <h1>You are not allowed to access this page</h1>\n\t\t}\n\t}\n}\n\nexport default EditShow;"]},"metadata":{},"sourceType":"module"}